<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><title>canvas实现九宫格解锁</title><style type="text/css" media="screen">body,html{margin:0;padding:0;overflow:hidden}#content{width:100%;height:100%;margin:0}header{text-align:center;position:fixed;top:0;width:100%;height:40px;line-height:40px;font-size:20px;padding-top:20px;color:#f08080}footer{position:fixed;bottom:0;width:100%;text-align:right;font-size:20px;color:#20b2aa}</style></head><body><header>绘制解锁图案</header><div id="content"></div><footer>解锁</footer><script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script><script type="text/javascript">function init(){ctx.clearRect(0,0,width,height),pointerArr=[];for(var t=0;t<arr.length;t++)arr[t].state=0,drawPointer(t)}function drawPointer(t){ctx.save();var e=0;e=hastouch?width/12:24;var r="#dd514c",o="#dd514c";1==arr[t].state&&(o="#1bd6c5"),ctx.beginPath(),ctx.fillStyle=r,ctx.arc(arr[t].x,arr[t].y,6,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.strokeStyle=o,ctx.lineWidth=.3,ctx.lineCap="round",ctx.lineJoin="round",ctx.arc(arr[t].x,arr[t].y,e,0,2*Math.PI,!1),ctx.stroke(),ctx.closePath(),ctx.restore()}function drawLinePointer(t,e,r){ctx.clearRect(0,0,width,height),ctx.save(),ctx.beginPath(),ctx.strokeStyle="#1bd6c5",ctx.lineWidth=5,ctx.lineCap="round",ctx.lineJoin="round";for(var o=0;o<pointerArr.length;o++)0==o?ctx.moveTo(pointerArr[o].x,pointerArr[o].y):ctx.lineTo(pointerArr[o].x,pointerArr[o].y);ctx.stroke(),ctx.closePath(),ctx.restore();for(var o=0;o<arr.length;o++)drawPointer(o),ctx.isPointInPath(t,e)&&currentPointer!=o&&(pointerArr.push({x:arr[o].x,y:arr[o].y}),currentPointer=o,puts.push(o+1),startX=arr[o].x,startY=arr[o].y,arr[o].state=1);r&&(ctx.save(),ctx.beginPath(),ctx.globalCompositeOperation="destination-over",ctx.strokeStyle="#e2e0e0",ctx.lineWidth=5,ctx.lineCap="round",ctx.lineJoin="round",ctx.moveTo(startX,startY),ctx.lineTo(t,e),ctx.stroke(),ctx.beginPath(),ctx.restore())}function settingUnlockPwd(){pwd.length<=0?(pwd=puts,init(),$("header").text("再次绘制解锁图案")):confirmPwd.length<=0&&(confirmPwd=puts),console.log(pwd+"  "+confirmPwd),pwd.length>0&&confirmPwd.length>0&&(compareArr(pwd,confirmPwd)?($("header").text("解锁图案绘制成功"),init()):($("header").text("两次绘制的解锁图案不一致"),init(),confirmPwd=[]))}function unlock(){console.log("解锁密码："+puts+"  "+confirmPwd),compareArr(puts,confirmPwd)?$("header").text("解锁成功!页面跳转中......"):($("header").text("解锁图案不正确！！！"),init())}function compareArr(t,e){return t.toString()===e.toString()}var width=$(document).width(),height=$(document).height()-40,canvas=document.createElement("canvas");canvas.width=width+.5,canvas.height=height+.5,canvas.id="lock",document.getElementById("content").appendChild(canvas);var isMouseDown=!1,lockCnavs=$("#lock")[0],ctx=lockCnavs.getContext("2d"),lockCicle={x:0,y:0,color:"#999999",state:"1"},hastouch="ontouchstart"in window?!0:!1,tapstart=hastouch?"touchstart":"mousedown",tapmove=hastouch?"touchmove":"mousemove",tapend=hastouch?"touchend":"mouseup",pointerArr=[],startX,startY,puts=[],currentPointer,offset=(width-height)/2,arr=[],pwd=[],confirmPwd=[],unlockFlag=!1;console.log(width+"         "+height);for(var i=1;3>=i;i++)for(var j=1;3>=j;j++){var lockCicle={};offset>0?(lockCicle.x=height/4*j+Math.abs(offset),lockCicle.y=height/4*i,lockCicle.state=0):(lockCicle.x=width/4*j,lockCicle.y=width/4*i+Math.abs(offset),lockCicle.state=0),arr.push(lockCicle)}init(),lockCnavs.addEventListener(tapstart,function(t){isMouseDown=!0;var e=hastouch?t.targetTouches[0].pageX:t.clientX-canvas.offsetLeft,r=hastouch?t.targetTouches[0].pageY:t.clientY-canvas.offsetTop;drawLinePointer(e,r,!0)}),lockCnavs.addEventListener(tapmove,function(t){if(isMouseDown){var e=hastouch?t.targetTouches[0].pageX:t.clientX-canvas.offsetLeft,r=hastouch?t.targetTouches[0].pageY:t.clientY-canvas.offsetTop;drawLinePointer(e,r,!0)}}),lockCnavs.addEventListener(tapend,function(t){drawLinePointer(0,0,!1),isMouseDown=!1,pointerArr=[],puts.length>=6?(alert("你的图形密码是: [   "+puts.join("    >   ")+"   ]"),unlockFlag?unlock():settingUnlockPwd()):puts.length>=1&&(alert("你的图形密码太简单了~~~"),init()),puts=[]}),$("footer").click(function(){"解锁"===$(this).text()&&(unlockFlag=!0,init(),$("header").text("绘制解锁图案"))})</script></body></html>